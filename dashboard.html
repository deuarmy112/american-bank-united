<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        if (!localStorage.getItem('authToken')) {
            window.location.href = 'index.html';
        }
    </script>
        <title>Dashboard - Opay</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="css/opay.css">
        <script src="js/global-ui.js" defer></script>
        <style>
            body { background: #f8fafc }
        </style>
        <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
</head>
<body class="opay-ui">
        <!-- Navigation -->
        <header class="opay-header">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-4">
                                                <a href="/" class="opay-brand"><div>
                                                    <div class="opay-name">Opay</div>
                                                    <div class="opay-sub">Everyday banking</div>
                                                </div></a>
                                        </div>
                </div>
            </div>
        </header>

        <main class="max-w-md mx-auto p-4 pb-32">
            <!-- Mobile app top area -->
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-lg font-semibold">Good day, <span id="userGreeting">User</span></h2>
                    <p class="text-xs text-slate-500">Smart banking at your fingertips</p>
                </div>
                <div class="flex items-center gap-3">
                    <button class="relative">
                        <i class="fas fa-bell text-slate-700 text-lg"></i>
                        <span class="absolute -top-1 -right-1 bg-rose-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">3</span>
                    </button>
                    <a href="profile.html" aria-label="Open profile" title="Profile">
                        <img id="userAvatar" src="https://via.placeholder.com/40" alt="avatar" class="w-10 h-10 rounded-full border">
                    </a>
                </div>
            </div>

            <!-- Deposit Modal -->
            <div id="modal-deposit" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50">
                <div class="bg-white rounded-lg w-11/12 max-w-md p-4">
                    <h3 class="text-lg font-semibold mb-2">Deposit Funds</h3>
                    <form onsubmit="submitDeposit(event)">
                        <label class="block text-sm">Account</label>
                        <select id="depositAccount" class="w-full border rounded p-2 mb-2"></select>
                        <label class="block text-sm">Amount</label>
                        <input id="depositAmount" type="number" step="0.01" class="w-full border rounded p-2 mb-2" placeholder="0.00" />
                        <div class="flex justify-end gap-2">
                            <button type="button" onclick="closeFeatureModal('deposit')" class="px-4 py-2">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Deposit</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Withdraw Modal -->
            <div id="modal-withdraw" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50">
                <div class="bg-white rounded-lg w-11/12 max-w-md p-4">
                    <h3 class="text-lg font-semibold mb-2">Withdraw Funds</h3>
                    <form onsubmit="submitWithdraw(event)">
                        <label class="block text-sm">Account</label>
                        <select id="withdrawAccount" class="w-full border rounded p-2 mb-2"></select>
                        <label class="block text-sm">Amount</label>
                        <input id="withdrawAmount" type="number" step="0.01" class="w-full border rounded p-2 mb-2" placeholder="0.00" />
                        <div class="flex justify-end gap-2">
                            <button type="button" onclick="closeFeatureModal('withdraw')" class="px-4 py-2">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded">Withdraw</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Balance card (Opay-like) -->
            <div class="bg-gradient-to-r from-orange-500 to-rose-500 text-white rounded-2xl p-4 shadow-lg mb-4">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm opacity-90">Total Balance</p>
                        <p id="totalBalance" class="text-2xl font-bold mt-2">$0.00</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs opacity-80">Available</p>
                        <button onclick="openFeatureModal('')" class="mt-1 bg-white/20 px-3 py-1 rounded-full text-xs">Details</button>
                    </div>
                </div>
                <div class="mt-4 flex gap-3">
                    <button onclick="location.href='transfer.html'" class="flex-1 bg-white/20 rounded-lg py-2 text-sm">Transfer</button>
                    <button onclick="openFeatureModal('airtime')" class="bg-white/20 rounded-lg px-3 py-2 text-sm">Airtime</button>
                </div>
            </div>

            <!-- Quick actions (circular) -->
            <div class="mb-4">
                <div class="flex gap-3 overflow-x-auto pb-2">
                    <button onclick="location.href='transfer.html'" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-exchange-alt text-orange-500"></i></div>
                        <span class="text-xs">Transfer</span>
                    </button>
                    <button onclick="openFeatureModal('bill')" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-file-invoice-dollar text-red-500"></i></div>
                        <span class="text-xs">Pay Bills</span>
                    </button>
                    <button onclick="openFeatureModal('airtime')" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-signal text-green-500"></i></div>
                        <span class="text-xs">Airtime</span>
                    </button>
                    <button onclick="openFeatureModal('bet')" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-football-ball text-indigo-500"></i></div>
                        <span class="text-xs">Betting</span>
                    </button>
                    <button onclick="location.href='cards.html'" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-credit-card text-sky-500"></i></div>
                        <span class="text-xs">Cards</span>
                    </button>
                    <button onclick="openFeatureModal('qr')" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-qrcode text-slate-700"></i></div>
                        <span class="text-xs">QR Pay</span>
                    </button>
                    <button onclick="openBeneficiariesModal()" class="flex-none flex flex-col items-center gap-1 w-20">
                        <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow"><i class="fas fa-users text-indigo-600"></i></div>
                        <span class="text-xs">Beneficiaries</span>
                    </button>
                </div>
            </div>

            <!-- Promo banner -->
            <div class="mb-4">
                <div class="bg-gradient-to-r from-sky-500 to-indigo-600 text-white rounded-lg p-4 shadow">
                    <h3 class="font-semibold">Save more with SmartSave</h3>
                    <p class="text-xs opacity-90">Auto-save daily, weekly or monthly â€” earn interest</p>
                </div>
            </div>

            <!-- Accounts carousel -->
            <div class="mb-4">
                <h3 class="text-sm font-medium mb-2">Your Accounts</h3>
                <div id="accountsList" class="flex gap-3 overflow-x-auto">
                    <!-- account cards will be injected here -->
                </div>
            </div>

            <!-- Recent activity -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-medium">Recent Activity</h3>
                    <a href="transactions.html" class="text-xs text-slate-500">See all</a>
                </div>
                <div id="recentTransactions" class="space-y-2">
                    <!-- transactions injected here -->
                </div>
            </div>
        </main>

        <script src="js/utils.js"></script>
        <script src="js/api.js"></script>
        <script src="js/auth.js"></script>
        <script src="js/dashboard-api.js"></script>
        <script src="js/features.js"></script>
        <script src="js/ui.js"></script>
                <script>
                    // expose small helper for beneficiaries open from quick actions
                    async function openBeneficiariesModal() { if (window.openFeatureModal) { openFeatureModal('beneficiaries'); await loadBeneficiaries(); } }
                </script>

        <!-- Feature sheet + bottom nav -->
        <div id="featureBackdrop" onclick="featureBackdropClick(event)" class="hidden fixed inset-0 bg-black/40 z-40"></div>
        <div id="featureSheet" class="hidden fixed bottom-0 left-0 right-0 z-50 transform translate-y-full transition-transform duration-300">
            <div class="max-w-3xl mx-auto bg-white rounded-t-2xl shadow-lg p-4">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">Quick Actions</h3>
                    <button onclick="closeFeatureSheet()" class="text-slate-500">Close</button>
                </div>
                <div class="grid grid-cols-4 gap-3 mt-4">
                    <a href="transfer.html" class="flex flex-col items-center p-3 bg-slate-50 rounded-lg"> <i class="fas fa-exchange-alt text-lg text-indigo-600"></i> <span class="text-xs mt-1">Transfer</span></a>
                    <a href="#" class="flex flex-col items-center p-3 bg-slate-50 rounded-lg"> <i class="fas fa-money-bill-wave text-lg text-green-600"></i> <span class="text-xs mt-1">Deposit</span></a>
                    <a href="#" class="flex flex-col items-center p-3 bg-slate-50 rounded-lg"> <i class="fas fa-hand-holding-dollar text-lg text-rose-600"></i> <span class="text-xs mt-1">Withdraw</span></a>
                    <a href="bills.html" class="flex flex-col items-center p-3 bg-slate-50 rounded-lg"> <i class="fas fa-file-invoice-dollar text-lg text-yellow-600"></i> <span class="text-xs mt-1">Bill Pay</span></a>
                </div>
                <div class="mt-4 text-xs text-slate-500">More: Scheduled payments, External transfers, Statements, Support</div>
            </div>
        </div>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t z-30">
            <div class="max-w-7xl mx-auto flex justify-between px-6 py-2">
                <a href="dashboard.html" class="flex flex-col items-center text-indigo-600 text-xs"><i class="fas fa-home text-lg"></i>Home</a>
                <a href="accounts.html" class="flex flex-col items-center text-slate-600 text-xs"><i class="fas fa-wallet text-lg"></i>Accounts</a>
                <button onclick="toggleFeatureSheet()" class="-mt-6 bg-indigo-600 text-white p-3 rounded-full shadow-lg"><i class="fas fa-star"></i></button>
                <a href="transactions.html" class="flex flex-col items-center text-slate-600 text-xs"><i class="fas fa-receipt text-lg"></i>History</a>
                <a href="index.html" class="flex flex-col items-center text-slate-600 text-xs"><i class="fas fa-user text-lg"></i>Profile</a>
            </div>
        </nav>

        <!-- Feature Modals -->
        <div id="modalBackdrop" class="hidden fixed inset-0 bg-black/40 z-40"></div>

        <!-- Bill Pay Modal -->
        <div id="modal-bill" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div class="bg-white rounded-t-2xl sm:rounded-xl w-full max-w-md p-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">Pay a Bill</h3>
                    <button onclick="closeFeatureModal('bill')" class="text-slate-500">Close</button>
                </div>
                <form id="billForm" class="mt-4 space-y-3" onsubmit="submitBill(event)">
                    <select id="billerSelect" required class="w-full rounded-md border px-3 py-2">
                        <option value="">Select biller</option>
                    </select>
                    <select id="fromAccountSelect" required class="w-full rounded-md border px-3 py-2">
                        <option value="">From account</option>
                    </select>
                    <input id="billAmount" type="number" step="0.01" min="0.1" required class="w-full rounded-md border px-3 py-2" placeholder="Amount">
                    <input id="billMemo" type="text" class="w-full rounded-md border px-3 py-2" placeholder="Memo (optional)">
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md">Pay Now</button>
                </form>
            </div>
        </div>

        <!-- QR Pay Modal -->
        <div id="modal-qr" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div class="bg-white rounded-t-2xl sm:rounded-xl w-full max-w-md p-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">QR Payment</h3>
                    <button onclick="closeFeatureModal('qr')" class="text-slate-500">Close</button>
                </div>
                <form class="mt-4 space-y-3" onsubmit="submitQRPay(event)">
                    <select id="qrFromAccount" required class="w-full rounded-md border px-3 py-2">
                        <option value="">From account</option>
                    </select>
                    <input id="qrAccountNumber" type="text" required class="w-full rounded-md border px-3 py-2" placeholder="Recipient account number">
                    <input id="qrAmount" type="number" step="0.01" min="0.1" required class="w-full rounded-md border px-3 py-2" placeholder="Amount">
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md">Pay</button>
                </form>
            </div>
        </div>

        <!-- Beneficiaries Modal -->
        <div id="modal-beneficiaries" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div class="bg-white rounded-t-2xl sm:rounded-xl w-full max-w-md p-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">Beneficiaries</h3>
                    <button onclick="closeFeatureModal('beneficiaries')" class="text-slate-500">Close</button>
                </div>
                <div class="mt-4">
                    <form id="beneficiaryForm" class="space-y-2" onsubmit="createBeneficiary(event)">
                        <input id="benName" type="text" required class="w-full rounded-md border px-3 py-2" placeholder="Full name">
                        <input id="benAccountNumber" type="text" class="w-full rounded-md border px-3 py-2" placeholder="Account number (optional)">
                        <input id="benBank" type="text" class="w-full rounded-md border px-3 py-2" placeholder="Bank name (optional)">
                        <input id="benNickname" type="text" class="w-full rounded-md border px-3 py-2" placeholder="Nickname (optional)">
                        <div class="flex gap-2">
                            <button type="submit" class="flex-1 bg-indigo-600 text-white py-2 rounded-md">Add</button>
                            <button type="button" onclick="closeFeatureModal('beneficiaries')" class="flex-1 border py-2 rounded-md">Done</button>
                        </div>
                    </form>
                    <div id="beneficiariesList" class="mt-4 space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Airtime/Data Modal -->
        <div id="modal-airtime" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div class="bg-white rounded-t-2xl sm:rounded-xl w-full max-w-md p-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">Buy Airtime / Data</h3>
                    <button onclick="closeFeatureModal('airtime')" class="text-slate-500">Close</button>
                </div>
                <form id="airtimeForm" class="mt-4 space-y-3" onsubmit="submitAirtime(event)">
                    <input id="phoneNumber" type="tel" required class="w-full rounded-md border px-3 py-2" placeholder="Phone number">
                    <select id="airtimeAmount" class="w-full rounded-md border px-3 py-2">
                        <option value="5">$5</option>
                        <option value="10">$10</option>
                        <option value="20">$20</option>
                    </select>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md">Buy</button>
                </form>
            </div>
        </div>

        <!-- Betting Modal (simulation) -->
        <div id="modal-bet" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div class="bg-white rounded-t-2xl sm:rounded-xl w-full max-w-md p-4 shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold">Place a Bet (Demo)</h3>
                    <button onclick="closeFeatureModal('bet')" class="text-slate-500">Close</button>
                </div>
                <form id="betForm" class="mt-4 space-y-3" onsubmit="submitBet(event)">
                    <input id="betAmount" type="number" step="0.01" min="1" required class="w-full rounded-md border px-3 py-2" placeholder="Amount to wager">
                    <select id="betType" class="w-full rounded-md border px-3 py-2">
                        <option value="win">Win/Lose</option>
                        <option value="score">Score Predictor</option>
                    </select>
                    <button type="submit" class="w-full bg-rose-600 text-white py-2 rounded-md">Place Bet</button>
                </form>
            </div>
        </div>
</body>
</html>
